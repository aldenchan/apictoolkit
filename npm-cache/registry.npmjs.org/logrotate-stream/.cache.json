{"_id":"logrotate-stream","_rev":"26-1b2629c14c77f415be3e0020df649439","name":"logrotate-stream","description":"Pipe log data to a stream, fuggetabout rotation","dist-tags":{"latest":"0.2.5"},"versions":{"0.0.1":{"name":"logrotate-stream","version":"0.0.1","description":"Pipe log data to a stream, fuggetabout rotation","scripts":{"test":"echo \"Error: no test specified\" && exit 1"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"log-rotate":"~0.2.0"},"devDependencies":{},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"_id":"logrotate-stream@0.0.1","dist":{"shasum":"60f03e8fe6af94308c4268c1a8e72db030e0cb57","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.0.1.tgz"},"_from":".","_npmVersion":"1.3.8","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.0.2":{"name":"logrotate-stream","version":"0.0.2","description":"Pipe log data to a stream, fuggetabout rotation","scripts":{"test":"echo \"Error: no test specified\" && exit 1"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"log-rotate":"~0.2.0"},"devDependencies":{},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"_id":"logrotate-stream@0.0.2","dist":{"shasum":"eb292c520e7c12f27fba1cfcab0965a70101f5e8","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.0.2.tgz"},"_from":".","_npmVersion":"1.3.8","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.1.0":{"name":"logrotate-stream","version":"0.1.0","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"log-rotate":"~0.2.2","optimist":"~0.6.0"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"_id":"logrotate-stream@0.1.0","dist":{"shasum":"1edec9891881e8d3e198b3e2cb07cbf365b5bcc5","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.1.0.tgz"},"_from":".","_npmVersion":"1.3.8","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.2.0":{"name":"logrotate-stream","version":"0.2.0","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"log-rotate":"~0.2.2","optimist":"~0.6.0","bytes":"~0.2.1"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"_id":"logrotate-stream@0.2.0","dist":{"shasum":"8c8dee8c62b5a23e29520e4cac5872587aec5f71","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.2.0.tgz"},"_from":".","_npmVersion":"1.3.8","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.2.1":{"name":"logrotate-stream","version":"0.2.1","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"byt":"~0.1.0","log-rotate":"~0.2.2","optimist":"~0.6.0"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"_id":"logrotate-stream@0.2.1","dist":{"shasum":"240846d0244a9a102c9019e9ac1da6697f61095c","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.2.1.tgz"},"_from":".","_npmVersion":"1.3.8","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.2.2":{"name":"logrotate-stream","version":"0.2.2","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"byt":"~0.1.0","log-rotate":"~0.2.2","optimist":"~0.6.0"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"_id":"logrotate-stream@0.2.2","dist":{"shasum":"ba85b0f9d272d2cac2a3ebbe034cddea0e9d0160","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.2.2.tgz"},"_from":".","_npmVersion":"1.3.8","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.2.3":{"name":"logrotate-stream","version":"0.2.3","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"byt":"~0.1.0","log-rotate":"~0.2.2","optimist":"~0.6.0"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"homepage":"https://github.com/dstokes/logrotate-stream","_id":"logrotate-stream@0.2.3","dist":{"shasum":"39eacc8c9a479e79cdcbae1392170ed7e83c5363","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.2.3.tgz"},"_from":".","_npmVersion":"1.3.24","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"directories":{}},"0.2.4":{"name":"logrotate-stream","version":"0.2.4","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"byt":"~0.1.0","log-rotate":"~0.2.2","optimist":"~0.6.0"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"gitHead":"6019b6788284639ba117ab2881d61616398559d8","homepage":"https://github.com/dstokes/logrotate-stream","_id":"logrotate-stream@0.2.4","_shasum":"e0eb339b3cdca36862571ee149ba7f67028b1561","_from":".","_npmVersion":"2.1.2","_nodeVersion":"0.10.32","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"dist":{"shasum":"e0eb339b3cdca36862571ee149ba7f67028b1561","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.2.4.tgz"},"directories":{}},"0.2.5":{"name":"logrotate-stream","version":"0.2.5","description":"Pipe log data to a stream, fuggetabout rotation","main":"index.js","bin":{"logrotate-stream":"./bin/logrotate-stream"},"scripts":{"test":"node test/logrotate-stream.js"},"author":{"name":"Drew Stokes"},"license":"BSD-2-Clause","dependencies":{"byt":"~0.1.0","log-rotate":"~0.2.2","optimist":"~0.6.0"},"devDependencies":{"tape":"~2.1.0"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"gitHead":"28648d03c63651ffe4a01399c4434a19a63ebc14","homepage":"https://github.com/dstokes/logrotate-stream","_id":"logrotate-stream@0.2.5","_shasum":"fdd42e7982a7ee2eb86b55f5f23dcbffc66e6990","_from":".","_npmVersion":"2.4.1","_nodeVersion":"1.1.0","_npmUser":{"name":"dstokes","email":"drew@drewstokes.com"},"maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"dist":{"shasum":"fdd42e7982a7ee2eb86b55f5f23dcbffc66e6990","tarball":"https://registry.npmjs.org/logrotate-stream/-/logrotate-stream-0.2.5.tgz"},"directories":{}}},"readme":"logrotate-stream\n================\n\nA Writable Stream that supports linux logrotate style options\n\n[![Build Status](https://travis-ci.org/dstokes/logrotate-stream.png)](https://travis-ci.org/dstokes/logrotate-stream)\n[![Donate](http://img.shields.io/bitcoin/donate.png?color=blue)](https://www.coinbase.com/dstokes)  \n[![NPM](https://nodei.co/npm/logrotate-stream.png?downloads=true)](https://nodei.co/npm/logrotate-stream/)  \n\nexample\n=======\nOn the command line:\n``` sh\n  node app.js 2>&1 | logrotate-stream app.log --keep 3 --size '50m' --compress\n```\n\nAs a module:\n``` js\nvar stream = require('logrotate-stream')\n  , toLogFile = stream({ file: './test.log', size: '100k', keep: 3 });\n\nsomeStream.pipe(toLogFile);\n```\n\nthe problem\n===========\nRotating logs that are being written to with stdio redirection sucks. Using a\nutility like `logrotate` doesn't automagically update your processes log file \ndescriptor and you end up with several empty logs and one mega rotated log.\n\nThere's a couple ways to try and deal with this, but they all fall short:\n#### 1. Use `winston`'s log rotation feature for nodejs apps\n\nThis requires adding a new dependency and possibly code changes around logging\nlogic.\n\n#### 2. Restart your app on a process signal\n\nOften times, production apps can't be restarted willy-nilly\n\n#### 3. Use the `copytruncate` feature of `logrotate`\n\nThis only works if you don't need to guarantee that all of your log lines are\npersisted. `copytruncate` performs a non-atomic copy before truncating the\noriginal log, which means you can lose data in the process if the copy is slow.\n\n`logrotate-stream` tries to remedy this situation by acting as an intermediary\nbetween the application and the file system, piping `stdin` to log files and\nrotating those logfiles when necessary.\n\nupstart woes\n============\nIf you find yourself using logrotate-stream with upstart, there's a few things\nto consider. Piping to logrotate-stream in your `exec` line will cause upstart\nto track the pid of the logrotate process rather than your app. While stopping\nwill still work (most likely emitting an EPIPE error on your app before\nexiting), it would be better if you used a named pipe to redirect your apps output:\n```\nchdir /path/to/app\n\npre-start script\n  # create a named pipe\n  mkfifo logpipe\n  # create a backgrounded logrotate-stream process and\n  # redirect the named pipe data to it\n  logrotate-stream app.log --keep 3 --size 50m < logpipe &\nend script\n\n# start the app, redirecting stdout & stderr to the named pipe\nexec /usr/local/bin/node index.js > logpipe 2>&1\n```\n\nThis setup will register the correct pid with upstart, make sure your stdio\nis forwarded to logrotate-stream, and will properly kill the logrotate-stream\nprocess when your app is stopped.\n\noptions\n=======\n\n### file\nThe file log file to write data to.\n\n### size\nThe max file size of a log before rotation occurs. Supports `1024`, `1k`, `1m`, `1g`\n\n### keep\nThe number of rotated log files to keep (including the primary log file). \nAdditional logs are deleted no rotation.\n\n### compress\nOptionally compress rotated files with gzip.\n\ninstall\n=======\n\nWith [npm](http://npmjs.org) do:\n\n```\nnpm install logrotate-stream\n```\n","maintainers":[{"name":"dstokes","email":"drew@drewstokes.com"}],"time":{"modified":"2015-02-13T01:36:59.989Z","created":"2013-11-13T01:57:32.115Z","0.0.1":"2013-11-13T01:57:33.215Z","0.0.2":"2013-11-13T18:30:53.875Z","0.1.0":"2013-11-14T18:03:23.617Z","0.2.0":"2013-11-15T23:24:23.092Z","0.2.1":"2013-11-16T21:12:49.809Z","0.2.2":"2013-11-19T19:39:25.342Z","0.2.3":"2014-01-29T21:31:03.186Z","0.2.4":"2015-01-26T18:53:06.548Z","0.2.5":"2015-02-13T01:36:59.989Z"},"author":{"name":"Drew Stokes"},"repository":{"type":"git","url":"git://github.com/dstokes/logrotate-stream.git"},"readmeFilename":"README.md","users":{"chengen":true,"j3kz":true,"adamlu":true,"52u":true},"homepage":"https://github.com/dstokes/logrotate-stream","keywords":["log","rotate","pipe","stream"],"bugs":{"url":"https://github.com/dstokes/logrotate-stream/issues"},"license":"BSD-2-Clause","_attachments":{},"_etag":"\"18DVN53JMCCENFEH4SUNLOUHS\"","_cached":true}